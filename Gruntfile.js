/*============================================================================*\
	DO NOT EDIT THIS FILE. THIS IS A CORE FILE.
/*============================================================================*/

module.exports = function(grunt) {
	var key;

	// Get user project file
	var projectFile = grunt.file.readJSON('project.json');

	// Get project file overrides
	var projectFileOverrides = grunt.file.readJSON('projectOverrides.json');

	// Set the assets path
	var assetsPath = projectFile.root + '/' + projectFile.assets;

	// Set the assets source
	var assetsSource = projectFile.source;

	// Get base project file
	var baseProjectFile = grunt.file.readJSON(assetsSource + '/coreFAB/project.json');

	// Set buildScripts source
	var buildScripts = './' + assetsSource + '/coreFAB/buildScripts/';

	// Create vars variable
	var vars;

	// Loop through keys in base project file and make sure they are set
	for (key in baseProjectFile) {
		projectFile[key] = projectFile[key] || baseProjectFile[key];
	}

	// Loop through keys in the projectFileOverrides
	for (key in projectFileOverrides) {
		// Override anything in the project file
		projectFile[key] = projectFileOverrides[key];
	}

	// Set vars
	vars = {
		packageFile: grunt.file.readJSON('package.json'),
		projectFile: projectFile,
		projectFileOverrides: projectFileOverrides,
		root: projectFile.root,
		watch: projectFile.watch,
		assetsPath: projectFile.root + '/' + projectFile.assets,
		assetsSource: assetsSource,
		enabledJsComponents: projectFile.enabledJsComponents,
		disabledJsComponents: projectFile.disabledJsComponents,
		conf: {
			root: projectFile.root,
			assetsPath: assetsPath,
			assetsSource: assetsSource,
			bsFiles: {
				src: [
					assetsPath + '/css/style.min.css',
					assetsPath + '/js/lib/**/*.js',
					assetsPath + '/js/**/*.js'
				]
			},
			bsOptions: {
				watchTask: true,
				proxy: projectFile.proxy,
				ghostMode: {
					clicks: false,
					forms: false,
					scroll: false,
					links: false
				},
				open: 'local',
				notify: false
			},
			lessCompress: projectFile.lessCompress,
			lessFiles: {},
			jsFiles: {},
			sourceMaps: projectFile.sourceMaps
		}
	};

	// Delete files and cache
	vars = require(buildScripts + '01-cleanUp.js')(grunt, vars);

	// Configure watch and proxy
	vars = require(buildScripts + '02-watchConfg.js')(grunt, vars);

	// Configure Less
	vars = require(buildScripts + '03-lessConfig.js')(grunt, vars);

	// Configure JS
	vars = require(buildScripts + '04-jsConfig.js')(grunt, vars);

	// Configure Compile Modules
	vars = require(buildScripts + '05-compileModuleConfig.js')(grunt, vars);

	// Configure version file
	vars = require(buildScripts + '06-versionConfig.js')(grunt, vars);

	// Initialize grunt config
	require(buildScripts + '07-initConfig.js')(grunt, vars);

	// Load NPM Tasks
	grunt.loadNpmTasks('grunt-contrib-clean');
	grunt.loadNpmTasks('grunt-contrib-copy');
	grunt.loadNpmTasks('grunt-contrib-less');
	grunt.loadNpmTasks('grunt-contrib-uglify');
	grunt.loadNpmTasks('grunt-contrib-watch');
	grunt.loadNpmTasks('grunt-contrib-jshint');
	grunt.loadNpmTasks('grunt-curl');
	grunt.loadNpmTasks('grunt-http');
	grunt.loadNpmTasks('grunt-jscs');
	grunt.loadNpmTasks('grunt-notify');
	grunt.loadNpmTasks('grunt-browser-sync');
	grunt.loadNpmTasks('grunt-zip');

	// Register grunt default task
	grunt.registerTask('default', [
		'clean',
		'copy',
		'less',
		'uglify',
		'notify:less',
		'notify:uglify',
		'browserSync',
		'watch'
	]);

	// Register grunt compile task
	grunt.registerTask('compile', [
		'clean',
		'copy',
		'less',
		'uglify'
	]);

	// Register module task
	require(buildScripts + '08-createBuildModule.js')(grunt, vars);

	// Register check task
	grunt.registerTask('check', [
		'http:check'
	]);

	// Register check task
	require(buildScripts + '10-update.js')(grunt, vars);
	grunt.registerTask('update', [
		'http:check',
		'curl:downloadUpdate',
		'unzip:update',
		'updateFiles'
	]);
};
